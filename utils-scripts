// Delete all test user roles
const { rows } = await pool.query(`
  SELECT usename AS role_name,
    CASE 
      WHEN usesuper AND usecreatedb THEN 
      CAST('superuser, create database' AS pg_catalog.text)
      WHEN usesuper THEN 
        CAST('superuser' AS pg_catalog.text)
      WHEN usecreatedb THEN 
        CAST('create database' AS pg_catalog.text)
      ELSE 
        CAST('' AS pg_catalog.text)
    END role_attributes
  FROM pg_catalog.pg_user
  ORDER BY role_name desc;
`);

for (const row of rows) {
  if (row.role_attributes === "") {
    await pool.query(format("DROP OWNED BY %I CASCADE", row.role_name));
    await pool.query(format("DROP ROLE %I", row.role_name));
  }
}
